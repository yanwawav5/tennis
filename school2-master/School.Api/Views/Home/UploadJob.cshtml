@{
    Layout = null;
}
<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
    <title>上传作业</title>
    <link rel="stylesheet" href="/layui/css/layui.css">
    <link rel="stylesheet" href="/css/common.css">
    <style type="text/css">
        body {
            background-color: #efefef;
        }
    </style>
</head>
<body>
    <div class="send_task_box">
        <div id="upload">
            <image class="icon" src="/images/icon_camera.png" style="width:50px;height:50px;" bindtap="chooseVideo"></image>
            <div class="name" bindtap="chooseVideo">
                上传作业
                <div class="desc">相册/拍视频</div>
            </div>
        </div>
        <div class="btn_group float_after" id="camrea_tip" style="display: none;">
            <div class="tip float_left">您已选择视频，是否提交？</div>
            <div class="btn float_right" id="btn">提交</div>
        </div>
    </div>
    <script src="/js/jquery.js"></script>
    <script src="/layui/layui.js"></script>
</body>
<script type="text/javascript">
    var src = "";
    layui.use('upload', function () {
        var upload = layui.upload;

        //执行实例
        var upload_index = "";
        var uploadInst = upload.render({
            elem: '#upload' //绑定元素
            , url: '/wapi/user/Upload/' //上传接口
            , accept: "file"
            , auto: true //是否开启自动上传
            , before: function (obj) {
                upload_index = layer.load(0);
            }
            , done: function (res) {
                src = res.Body.Model.Str;
                layer.close(upload_index)
                $("#camrea_tip").css("display", "block");
            }
            , error: function (res) {
                alert("请等待上传完文件再提交");
                return false;
            }
        });
    });

    $(function () {
        $("#btn").click(function () {
            var type = '@ViewBag.type';
            var id = '@ViewBag.id';
            var url = "";
            if (type == "1") {
                url = '/wapi/wadmin/SaveStudentJob';
            }
            if (type == "0"||type=="2") {
                url = '/wapi/wadmin/SaveCourseVideoUrl';
            }
            var url=
            $.ajax({
                headers: { 'Content-Type': 'application/json;charset=utf8', 'MyHeader': "{'UserKey':'@ViewBag.Uid'}" },
                url: url,
                type: "post",
                dataType: "json",
                data: JSON.stringify({
                    "id": id,
                    "CourseVideoUrl": src,
                    "VideoUrl": src
                }),
                success: function (data) {
                    if (data.IsSuccess)
                        location.href = @System.Web.Configuration.WebConfigurationManager.AppSettings["DomainName"] + "/home/dklist?id="+@ViewBag.type;
                }, error: function (res) {
                    alert("操作失败！");
                }
            })
        });
    })
</script>
</html>
